<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>测试消息显示功能</title>
    <script src="/webjars/jquery/3.6.0/jquery.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 600px; margin: 0 auto; }
        .message { margin-bottom: 10px; padding: 10px; border-radius: 5px; }
        .message.sent { background-color: #e3f2fd; text-align: right; }
        .message.received { background-color: #f5f5f5; }
        .message.system { background-color: #f3e5f5; font-style: italic; }
        #messages { height: 300px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; margin-bottom: 15px; }
        button { padding: 8px 15px; margin-right: 10px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="container">
        <h1>消息显示功能测试</h1>
        
        <div id="messages">
            <!-- 测试消息将显示在这里 -->
        </div>
        
        <div>
            <button onclick="testMessageDisplay()">测试消息显示</button>
            <button onclick="clearMessages()">清除消息</button>
        </div>
        
        <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
            <p>这个页面用于测试消息显示功能，验证我们修复了字段命名不一致的问题。</p>
            <p>点击"测试消息显示"按钮，将显示不同类型的消息（发送、接收、系统）。</p>
        </div>
    </div>

    <script>
        // 复制自chat.html的showMessage函数，但使用了正确的messageType字段
        function showMessage(message) {
            const messagesDiv = $('#messages');
            const messageClass = message.messageType === 'JOIN' || message.messageType === 'LEAVE' ? 'system' : 
                                message.senderName === '当前用户' ? 'sent' : 'received';
            
            let messageElement = '<div class="message ' + messageClass + '">';
            
            if (message.messageType === 'JOIN') {
                messageElement += '<em>' + message.senderName + ' 加入了聊天室</em>';
            } else if (message.messageType === 'LEAVE') {
                messageElement += '<em>' + message.senderName + ' 离开了聊天室</em>';
            } else {
                messageElement += '<strong>' + message.senderName + ':</strong> ' + message.content;
            }
            
            messageElement += '</div>';
            messagesDiv.append(messageElement);
            messagesDiv.scrollTop(messagesDiv[0].scrollHeight);
        }
        
        // 测试显示各种类型的消息
        function testMessageDisplay() {
            // 发送的消息
            showMessage({
                messageType: 'CHAT',
                senderName: '当前用户',
                content: '这是一条发送的测试消息'
            });
            
            // 接收的消息
            showMessage({
                messageType: 'CHAT',
                senderName: '其他用户',
                content: '这是一条接收的测试消息'
            });
            
            // 系统消息 - 加入
            showMessage({
                messageType: 'JOIN',
                senderName: '新用户',
                content: '新用户加入了聊天室'
            });
            
            // 系统消息 - 离开
            showMessage({
                messageType: 'LEAVE',
                senderName: '离开的用户',
                content: '用户离开了聊天室'
            });
        }
        
        // 清除消息
        function clearMessages() {
            $('#messages').empty();
        }
    </script>
</body>
</html>